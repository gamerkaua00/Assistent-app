<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dev.Pro Suite V69 (Stable)</title>
    
    <!-- PWA Meta -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#020617">
    
    <!-- Favicon -->
    <link rel="icon" id="favicon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0iIzAyMDYxNyIvPjxwYXRoIGQ9Ik0yNTYgNjRMNjQgMTYwdjE5MmwxOTIgOTYgMTkyLTk2VjE2MEwyNTYgNjR6IiBmaWxsPSIjM2I4MmY2Ii8+PHBhdGggZD0iTTI1NiAxMjBsLTEyMCA2MHYxMzVsMTIwIDYwIDEyMC02MFYxODBMMjU2IDEyMHoiIGZpbGw9IiMxZTI5M2IiLz48L3N2Zz4=">

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Core Styles & Scroll Logic */
        body { background-color: #020617; color: #f8fafc; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        .h-safe { height: 100vh; height: 100dvh; display: flex; flex-direction: column; }
        .content { flex: 1; overflow-y: auto; scroll-behavior: smooth; padding-bottom: 140px; }
        .glass { background: rgba(15, 23, 42, 0.95); border-bottom: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; } 
        ::-webkit-scrollbar-track { background: #0f172a; } 
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .no-scrollbar::-webkit-scrollbar { display: none; } 
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .fade-in { animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1); } 
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .font-lcd { font-family: 'Courier New', Courier, monospace; letter-spacing: 2px; }
        
        #print-area { display: none; } 
        @media print { body * { visibility: hidden; } #root { display: none; } #print-area { display: block !important; visibility: visible !important; position: absolute; left: 0; top: 0; width: 100%; padding: 20px; background: white; color: black; font-family: sans-serif; } #print-area * { visibility: visible !important; } }
    </style>
</head>
<body>
    <div id="print-area"></div>
    <div id="root" class="h-safe w-screen"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- 1. CORE UTILS & ICONS ---
        const Icon = ({ name, size=24, className="" }) => {
            const paths = {
                close: <path d="M18 6L6 18M6 6l12 12" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                plus: <path d="M12 5v14M5 12h14" strokeWidth="2" strokeLinecap="round"/>,
                check: <path d="M20 6L9 17l-5-5" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                trash: <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" strokeWidth="2" strokeLinecap="round"/>,
                lock: <path d="M12 17v-3m0-8c-2.21 0-4 1.79-4 4v2h8v-2c0-2.21-1.79-4-4-4z" strokeWidth="2"/>,
                calendar: <path d="M19 4H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V6a2 2 0 00-2-2zM16 2v4M8 2v4M3 10h18" strokeWidth="2"/>,
                list: <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01" strokeWidth="2" strokeLinecap="round"/>,
                back: <path d="M19 12H5M12 19l-7-7 7-7" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                home: <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" strokeWidth="2"/>,
                sun: <circle cx="12" cy="12" r="5" strokeWidth="2"/>,
                rain: <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242M16 19v2M12 21v2M8 19v2" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                cloud: <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                kanban: <path d="M3 3h18v18H3zM9 3v18M15 3v18" strokeWidth="2"/>,
                news: <path d="M19 20H5a2 2 0 01-2-2V6a2 2 0 01-2-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" strokeWidth="2"/>,
                whatsapp: <path d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z" strokeWidth="2"/>,
                pdf: <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" strokeWidth="2"/>,
                refresh: <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                external: <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                clock: <circle cx="12" cy="12" r="10" strokeWidth="2"/>,
                calc: <rect x="4" y="2" width="16" height="20" rx="2" strokeWidth="2"/>,
                battery: <><rect x="1" y="6" width="18" height="12" rx="2" ry="2" strokeWidth="2"/><path d="M23 13v-2" strokeWidth="2"/></>,
                wifi: <path d="M5 12.55a11 11 0 0114.08 0M1.42 9a16 16 0 0121.16 0M8.53 16.11a6 6 0 016.95 0M12 20h.01" strokeWidth="2" strokeLinecap="round"/>,
                edit: <><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" strokeWidth="2"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" strokeWidth="2"/></>,
                grid: <><rect x="3" y="3" width="7" height="7" strokeWidth="2"/><rect x="14" y="3" width="7" height="7" strokeWidth="2"/><rect x="14" y="14" width="7" height="7" strokeWidth="2"/><rect x="3" y="14" width="7" height="7" strokeWidth="2"/></>,
                cart: <path d="M9 20a1 1 0 100 2 1 1 0 000-2zm7 0a1 1 0 100 2 1 1 0 000-2zm-7-4h7a1 1 0 001-1V9H8v6a1 1 0 001 1zm-3-8h16" strokeWidth="2" strokeLinecap="round"/>,
                checktext: <><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M9 15l2 2 4-4"/></>,
                flash: <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                bulb: <path d="M9 21h6v-1.5a2.5 2.5 0 0 1 2.5-2.5h0a5.5 5.5 0 1 0-11 0h0a2.5 2.5 0 0 1 2.5 2.5V21z" strokeWidth="2"/>,
                bell: <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                book: <><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" /><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" /></>,
                dumbbell: <><path d="M6.5 6.5l11 11" /><path d="M21 21l-1-1" /><path d="M3 3l1 1" /><path d="M18 22l4-4" /><path d="M2 6l4-4" /><path d="M3 10l7-7" /><path d="M14 21l7-7" /></>,
                apple: <path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z" strokeWidth="2"/>,
                fire: <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" strokeWidth="2"/>,
                run: <path d="M19 16l-3-2 1-4-3 1-1-4-4 2v3l-2 3H3v-2h3l2-3-1-3 2-1 3-1 2 2-2 4 4 3 2-2z" strokeWidth="2"/>,
                save: <><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>
            };
            return <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{paths[name]}</svg>;
        };

        const useStorage = (key, initial) => {
            const [val, setVal] = useState(() => {
                try { return JSON.parse(localStorage.getItem(key)) || initial; } catch { return initial; }
            });
            useEffect(() => localStorage.setItem(key, JSON.stringify(val)), [key, val]);
            return [val, setVal];
        };

        // --- 2. WORKER & NOTIFICATIONS ---
        const createWorker = () => {
            const blob = new Blob([`
                self.onmessage = function(e) { if (e.data === 'start') setInterval(() => self.postMessage('tick'), 10000); };
            `], { type: 'application/javascript' });
            return new Worker(URL.createObjectURL(blob));
        };

        const useNotifications = (events) => {
            const [perm, setPerm] = useState("default");
            const [notified, setNotified] = useState([]); 
            const workerRef = useRef(null);

            useEffect(() => {
                if ("Notification" in window) setPerm(Notification.permission);
                workerRef.current = createWorker();
                workerRef.current.postMessage('start');
                return () => workerRef.current && workerRef.current.terminate();
            }, []);

            const requestPermission = () => {
                if (!("Notification" in window)) return alert("Navegador sem suporte.");
                Notification.requestPermission().then(p => {
                    setPerm(p);
                    if(p === 'granted') new Notification("üîî Dev.Pro Suite", { body: "Notifica√ß√µes ativadas!" });
                });
            };

            const checkEvents = () => {
                if (perm !== 'granted') return;
                const now = new Date();
                const k = now.toISOString().split('T')[0];
                const dailyEvents = events[k] || [];
                const currentHM = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

                dailyEvents.forEach(evt => {
                    const timeMatch = evt.match(/^(\d{2}:\d{2})/);
                    if (timeMatch) {
                        const eventTime = timeMatch[1];
                        const eventId = k + evt; 
                        if (eventTime === currentHM && !notified.includes(eventId)) {
                            const cleanText = evt.replace(/^\d{2}:\d{2}\s*-\s*/, '');
                            try { new Notification("‚è∞ Lembrete", { body: cleanText, requireInteraction: true }); } catch(e) {}
                            setNotified(prev => [...prev, eventId]);
                        }
                    }
                });
            };

            useEffect(() => {
                if(!workerRef.current) return;
                const handler = (e) => { if(e.data === 'tick') checkEvents(); };
                workerRef.current.addEventListener('message', handler);
                return () => workerRef.current.removeEventListener('message', handler);
            }, [events, perm, notified]);

            return [perm, requestPermission];
        };

        // --- 3. UI COMPONENTS & HELPERS (Defined BEFORE feature tabs) ---
        const CalculatorModal = ({ close }) => {
            const [disp, setDisp] = useState("");
            const [prev, setPrev] = useState("");
            const [angleMode, setAngleMode] = useState('deg'); 

            const toggleMode = () => {
                if(angleMode === 'deg') setAngleMode('rad');
                else if(angleMode === 'rad') setAngleMode('gra');
                else setAngleMode('deg');
            };

            const btns = [
                {l:'(', f:'('}, {l:')', f:')'}, {l:'C', f:'C', c:'bg-red-900/50 text-red-200'}, {l:'DEL', f:'DEL', c:'bg-orange-900/50 text-orange-200'},
                {l:'sin', f:'sin('}, {l:'cos', f:'cos('}, {l:'tan', f:'tan('}, {l:'/', f:'/', c:'bg-indigo-900/50 text-indigo-200'},
                {l:'7', f:'7'}, {l:'8', f:'8'}, {l:'9', f:'9'}, {l:'*', f:'*', c:'bg-indigo-900/50 text-indigo-200'},
                {l:'4', f:'4'}, {l:'5', f:'5'}, {l:'6', f:'6'}, {l:'-', f:'-', c:'bg-indigo-900/50 text-indigo-200'},
                {l:'1', f:'1'}, {l:'2', f:'2'}, {l:'3', f:'3'}, {l:'+', f:'+', c:'bg-indigo-900/50 text-indigo-200'},
                {l:'0', f:'0'}, {l:'.', f:'.'}, {l:'^', f:'**'}, {l:'=', f:'=', c:'bg-emerald-600 text-white row-span-2'},
                {l:'œÄ', f:'3.14159'}, {l:'log', f:'log10('}, {l:'ln', f:'log('}, {l:'‚àö', f:'sqrt('}
            ];

            const calc = (b) => {
                if(b==='C') { setDisp(""); setPrev(""); }
                else if(b==='DEL') setDisp(disp.slice(0, -1));
                else if(b==='=') { 
                    try { 
                        const toRad = (x) => {
                            if (angleMode === 'deg') return x * (Math.PI / 180);
                            if (angleMode === 'gra') return x * (Math.PI / 200);
                            return x; 
                        };
                        const MathContext = {
                            sin: (x) => Math.sin(toRad(x)), cos: (x) => Math.cos(toRad(x)), tan: (x) => Math.tan(toRad(x)),
                            log: Math.log, log10: Math.log10, sqrt: Math.sqrt, pow: Math.pow, PI: Math.PI
                        };
                        let expr = disp.replace(/sin/g, 'MathContext.sin').replace(/cos/g, 'MathContext.cos').replace(/tan/g, 'MathContext.tan')
                            .replace(/log10/g, 'MathContext.log10').replace(/\blog\b/g, 'MathContext.log10').replace(/ln/g, 'MathContext.log')
                            .replace(/sqrt/g, 'MathContext.sqrt').replace(/\^/g, '**').replace(/œÄ/g, 'MathContext.PI');
                        const res = eval(expr);
                        setPrev(disp + " =");
                        setDisp(Number(res).toLocaleString('en-US', {maximumFractionDigits:8}).replace(/,/g,'')); 
                    } catch { setDisp("Erro"); } 
                } else setDisp(disp+b);
            };

            return (
                <div className="w-full">
                    <div className="flex justify-between items-start mb-4">
                        <h3 className="text-white font-bold flex items-center gap-2"><Icon name="calc" size={18}/> Casio FX-Dev</h3>
                        <button onClick={close} className="bg-red-500/20 text-red-400 p-2 rounded-full hover:bg-red-500 hover:text-white transition-colors"><Icon name="close" size={16}/></button>
                    </div>
                    <div className="bg-[#9ea792] p-4 rounded-t-xl border-4 border-slate-700 h-28 flex flex-col justify-between shadow-inner mb-4 relative overflow-hidden">
                        <div className="absolute inset-0 bg-black/5 pointer-events-none"></div>
                        <div className="z-10 flex justify-between w-full">
                            <button onClick={toggleMode} className="text-[10px] font-bold text-slate-700 bg-slate-500/20 px-1.5 py-0.5 rounded border border-slate-600/30 hover:bg-slate-500/30 transition-colors uppercase tracking-widest">{angleMode}</button>
                            <span className="text-slate-800 font-lcd text-xs h-4">{prev}</span>
                        </div>
                        <span className="text-slate-900 font-lcd text-3xl font-bold tracking-widest overflow-x-auto whitespace-nowrap w-full text-right z-10">{disp || "0"}</span>
                    </div>
                    <div className="grid grid-cols-4 gap-2 bg-slate-800 p-3 rounded-b-xl border border-t-0 border-slate-700">
                        {btns.map((b, i) => (
                            <button key={i} onClick={()=>calc(b.f)} className={`p-3 rounded-lg font-bold text-xs shadow-[0_3px_0_rgba(0,0,0,0.3)] active:shadow-none active:translate-y-[3px] transition-all border border-white/5 ${b.c ? b.c : 'bg-slate-700 text-slate-200 hover:bg-slate-600'} ${b.l==='=' ? 'row-span-2 flex items-center justify-center' : ''}`}>{b.l}</button>
                        ))}
                    </div>
                </div>
            );
        };

        const Modal = ({ cfg, close }) => {
            const [t, setT] = useState("");
            const [time, setTime] = useState("");
            const [extra, setExtra] = useState(""); 
            const [prot, setProt] = useState("");
            const [carb, setCarb] = useState("");
            const [fat, setFat] = useState("");

            useEffect(() => { 
                if(cfg.open) { 
                    setT(cfg.init||""); setTime(""); setExtra(""); setProt(""); setCarb(""); setFat("");
                } 
            }, [cfg.open, cfg.init]);

            if(!cfg.open) return null;

            const handleOk = () => {
                if (!t.trim() && !cfg.customValidation) return;
                let finalVal = t;
                if (cfg.isEvent) { const timePrefix = time ? time : "00:00"; finalVal = `${timePrefix} - ${t}`; }
                if (cfg.isWorkoutPlan) { finalVal = { name: t, id: Date.now(), exercises: [] }; }
                if (cfg.isExercise) { finalVal = { name: t, sets: extra, id: Date.now() }; }
                if (cfg.isDietPlan) { finalVal = { name: t, cal: Number(extra)||0, p: Number(prot)||0, c: Number(carb)||0, f: Number(fat)||0, id: Date.now() }; }
                if(cfg.ok) cfg.ok(finalVal);
                close();
            };

            return (
                <div className="fixed inset-0 z-[60] bg-black/80 flex items-center justify-center p-4 backdrop-blur-sm fade-in">
                    <div className="bg-slate-900 border border-slate-700 w-full max-w-sm rounded-2xl p-6 shadow-2xl relative">
                        {cfg.isCalc ? <CalculatorModal close={close} /> : (
                            <>
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-white font-bold text-lg">{cfg.title}</h3>
                                    <button onClick={close} className="text-slate-400 hover:text-white"><Icon name="close" size={20}/></button>
                                </div>
                                {!cfg.alert && (
                                    <div className="space-y-3 mb-4">
                                        {cfg.isEvent && (<div><label className="text-[10px] text-slate-400 font-bold uppercase ml-1">Hor√°rio</label><input type="time" value={time} onChange={e=>setTime(e.target.value)} className="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg text-white outline-none focus:border-blue-500"/></div>)}
                                        <div>
                                            <label className="text-[10px] text-slate-400 font-bold uppercase ml-1">{cfg.lbl || "Nome / Descri√ß√£o"}</label>
                                            <input autoFocus value={t} onChange={e=>setT(e.target.value)} placeholder={cfg.ph} className="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg text-white outline-none focus:border-blue-500"/>
                                        </div>
                                        {cfg.isExercise && (<div><label className="text-[10px] text-slate-400 font-bold uppercase ml-1">Meta (Ex: 3x12)</label><input value={extra} onChange={e=>setExtra(e.target.value)} placeholder="Ex: 3x12" className="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg text-white outline-none focus:border-red-500"/></div>)}
                                        {cfg.isDietPlan && (
                                            <>
                                                <div><label className="text-[10px] text-slate-400 font-bold uppercase ml-1">Calorias (Kcal)</label><input type="number" value={extra} onChange={e=>setExtra(e.target.value)} placeholder="0" className="w-full bg-slate-950 border border-slate-700 p-3 rounded-lg text-white outline-none focus:border-green-500"/></div>
                                                <div className="grid grid-cols-3 gap-2">
                                                    <div><label className="text-[10px] text-slate-400 font-bold uppercase">Prot (g)</label><input type="number" value={prot} onChange={e=>setProt(e.target.value)} className="w-full bg-slate-950 border border-slate-700 p-2 rounded text-white"/></div>
                                                    <div><label className="text-[10px] text-slate-400 font-bold uppercase">Carb (g)</label><input type="number" value={carb} onChange={e=>setCarb(e.target.value)} className="w-full bg-slate-950 border border-slate-700 p-2 rounded text-white"/></div>
                                                    <div><label className="text-[10px] text-slate-400 font-bold uppercase">Gord (g)</label><input type="number" value={fat} onChange={e=>setFat(e.target.value)} className="w-full bg-slate-950 border border-slate-700 p-2 rounded text-white"/></div>
                                                </div>
                                            </>
                                        )}
                                    </div>
                                )}
                                {cfg.alert && <p className="text-slate-300 mb-6 text-sm leading-relaxed">{cfg.msg}</p>}
                                <div className="flex justify-end gap-3"><button onClick={close} className="text-slate-400 hover:text-white px-3 py-2 text-sm font-bold transition-colors">Cancelar</button><button onClick={handleOk} className={`${cfg.del ? 'bg-red-600' : 'bg-blue-600'} text-white px-5 py-2 rounded-lg font-bold text-sm shadow-lg`}>Confirmar</button></div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        const QuickLinks = () => {
            const links = [{ n: 'Gemini', u: 'https://gemini.google.com', c: 'bg-gradient-to-r from-blue-600 to-purple-600' }, { n: 'GitHub', u: 'https://github.com', c: 'bg-slate-700' }, { n: 'ChatGPT', u: 'https://chat.openai.com', c: 'bg-emerald-700' }, { n: 'Stack', u: 'https://stackoverflow.com', c: 'bg-orange-600' }];
            return (<div className="grid grid-cols-4 gap-2">{links.map(l => (<a key={l.n} href={l.u} target="_blank" className={`${l.c} h-12 rounded-xl flex items-center justify-center text-[10px] font-bold text-white shadow-lg active:scale-95 transition-transform`}>{l.n}</a>))}</div>);
        };

        const Scratchpad = ({ title="Rascunho R√°pido", storageKey="scratchpad_v28" }) => {
            const [txt, setTxt] = useStorage(storageKey, '');
            return (
                <div className="bg-slate-800 border border-slate-700 p-3 rounded-xl flex flex-col h-40 relative">
                    <div className="flex justify-between items-center mb-2"><h4 className="text-[10px] text-slate-400 font-bold uppercase flex items-center gap-1"><Icon name="edit" size={12}/> {title}</h4>{txt && <button onClick={()=>setTxt("")} className="text-[10px] text-slate-500 hover:text-red-400 font-bold">LIMPAR</button>}</div>
                    <textarea className="flex-1 bg-slate-900/50 rounded border border-slate-700/50 p-2 text-xs text-slate-300 outline-none resize-none placeholder:text-slate-600" placeholder="Digite aqui..." value={txt} onChange={e=>setTxt(e.target.value)}/>
                </div>
            );
        };

        const SystemStatus = () => {
            const [online, setOnline] = useState(navigator.onLine);
            const [bat, setBat] = useState(null);
            useEffect(() => {
                const h = () => setOnline(navigator.onLine);
                window.addEventListener('online', h); window.addEventListener('offline', h);
                if(navigator.getBattery) navigator.getBattery().then(b => setBat(Math.round(b.level*100))); else setBat(100);
                return () => { window.removeEventListener('online', h); window.removeEventListener('offline', h); }
            }, []);
            return (
                <div className="flex gap-2 mb-4">
                    <div className={`flex-1 p-2 rounded-lg flex items-center justify-center gap-2 text-xs font-bold border ${online ? 'bg-emerald-900/20 border-emerald-800 text-emerald-400' : 'bg-red-900/20 border-red-800 text-red-400'}`}><Icon name="wifi" size={14}/> {online ? 'Online' : 'Offline'}</div>
                    <div className="flex-1 p-2 rounded-lg flex items-center justify-center gap-2 text-xs font-bold bg-slate-800 border border-slate-700 text-slate-400"><Icon name="battery" size={14}/> {bat !== null ? bat + '%' : '--'}</div>
                </div>
            );
        };

        const FinanceCard = ({ label, value, trend, isBtc }) => (
            <div className="bg-slate-800 border border-slate-700 p-3 rounded-xl flex flex-col items-center justify-center">
                <span className="text-[10px] text-slate-400 font-bold uppercase mb-1">{label}</span>
                <div className="text-lg font-mono font-bold text-white flex items-center gap-1">{isBtc ? <span className="text-sm">R$ {value ? parseFloat(value).toLocaleString('pt-BR', {maximumFractionDigits:0}) : "--"}</span> : <><span className="text-xs text-slate-500">R$</span>{value ? parseFloat(value).toFixed(2) : "--"}</>}</div>
                {!isBtc && trend && <span className={`text-[10px] font-bold ${parseFloat(trend) >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>{parseFloat(trend) > 0 ? '+' : ''}{trend}%</span>}
            </div>
        );

        const MiniWeek = ({ events, onGoToAgenda }) => {
            const [sel, setSel] = useState(new Date());
            const days = useMemo(() => { 
                const arr = []; const today = new Date(); today.setHours(12,0,0,0); 
                for(let i=0; i<7; i++) { const d = new Date(today); d.setDate(today.getDate() + i); arr.push(d); } 
                return arr; 
            }, []);
            const k = (d) => d.toISOString().split('T')[0];
            const getEvts = (d) => { const daily = events[k(d)] || []; return [...daily].sort((a,b) => a.localeCompare(b)); };
            const selEvts = getEvts(sel);
            return (
                <div className="bg-slate-800 border border-slate-700 rounded-xl p-3 mb-1">
                    <div className="flex justify-between items-center mb-2"><h4 className="text-xs font-bold text-slate-400 uppercase flex items-center gap-1"><Icon name="calendar" size={12}/> Pr√≥ximos Dias</h4><button onClick={onGoToAgenda} className="text-[10px] text-blue-400 font-bold hover:underline">VER COMPLETO</button></div>
                    <div className="flex gap-2 overflow-x-auto pb-2 no-scrollbar mb-2">
                        {days.map(d => { 
                            const isSel = d.toDateString() === sel.toDateString(); 
                            const hasEvt = getEvts(d).length > 0; 
                            return (
                                <button key={d.toISOString()} onClick={()=>setSel(d)} className={`flex flex-col items-center justify-center min-w-[45px] h-14 rounded-lg transition-colors border ${isSel ? 'bg-blue-600 border-blue-500 text-white' : 'bg-slate-900 border-slate-700 text-slate-400 hover:bg-slate-750'}`}>
                                    <span className="text-[9px] font-bold uppercase">{d.toLocaleDateString('pt-BR', {weekday:'short'}).replace('.','')}</span>
                                    <span className="text-sm font-bold">{d.getDate()}</span>
                                    {hasEvt && <span className={`w-1 h-1 rounded-full mt-1 ${isSel?'bg-white':'bg-blue-400'}`}></span>}
                                </button>
                            )
                        })}
                    </div>
                    <div className="bg-slate-900/50 rounded-lg p-2 min-h-[40px]">
                        {selEvts.length > 0 ? (<div className="space-y-1">{selEvts.map((e, i) => { const timeMatch = e.match(/^(\d{2}:\d{2})\s-\s(.+)/); const time = timeMatch ? timeMatch[1] : ""; const text = timeMatch ? timeMatch[2] : e; return (<div key={i} className="text-xs text-slate-200 flex items-start gap-2">{time && <span className="font-mono font-bold text-blue-400 text-[10px] mt-0.5">{time}</span>}<span className="break-words flex-1">{text}</span></div>); })}</div>) : (<p className="text-[10px] text-slate-600 text-center py-1">Sem compromissos.</p>)}
                    </div>
                </div>
            );
        };

        // --- FEATURE TABS ---
        const ShoppingList = () => {
            const [shopList, setShopList] = useStorage('shopping_list_v34', []);
            const [newItem, setNewItem] = useState("");
            const [qty, setQty] = useState(1);
            const [price, setPrice] = useState("");
            const [cat, setCat] = useState("Mercado");
            const categories = ["Mercado", "Casa", "Tech", "Outros"];
            const addItem = (e) => { e.preventDefault(); if(!newItem.trim()) return; setShopList([...shopList, {id: Date.now(), txt: newItem, q:qty, p:Number(price)||0, done: false, category: cat}]); setNewItem(""); setQty(1); setPrice(""); };
            const toggle = (id) => setShopList(shopList.map(i => i.id===id ? {...i, done: !i.done} : i));
            const remove = (id) => setShopList(shopList.filter(i => i.id!==id));
            const total = shopList.reduce((acc, i) => acc + (i.p * i.q), 0);
            return (
                <div className="h-full flex flex-col fade-in">
                    <div className="glass p-4 sticky top-0 z-10 border-b border-slate-800 flex justify-between items-center"><h2 className="text-xl font-bold text-emerald-400 flex items-center gap-2"><Icon name="cart" size={20}/> Compras</h2></div>
                    <div className="content p-4 space-y-4">
                        <form onSubmit={addItem} className="bg-slate-800 p-3 rounded-xl border border-slate-700 flex flex-col gap-2">
                            <input value={newItem} onChange={e=>setNewItem(e.target.value)} placeholder="Item..." className="bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm outline-none text-white w-full"/>
                            <div className="flex gap-2">
                                <input type="number" value={qty} onChange={e=>setQty(Math.max(1, e.target.value))} className="bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm outline-none text-white w-20" placeholder="Qtd"/>
                                <input type="number" value={price} onChange={e=>setPrice(e.target.value)} className="bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm outline-none text-white flex-1" placeholder="R$ Estimado"/>
                            </div>
                            <div className="flex gap-2 overflow-x-auto pb-1 no-scrollbar">{categories.map(c => (<button type="button" key={c} onClick={()=>setCat(c)} className={`text-[10px] px-3 py-1 rounded-full font-bold transition-colors whitespace-nowrap ${cat===c ? 'bg-emerald-600 text-white' : 'bg-slate-700 text-slate-400'}`}>{c}</button>))}</div>
                            <button className="bg-emerald-600 text-white w-full py-2 rounded-lg font-bold text-xs mt-1 shadow-lg">ADICIONAR</button>
                        </form>
                        <div className="bg-slate-800 border border-slate-700 p-3 rounded-xl flex justify-between items-center"><span className="text-xs text-slate-400 uppercase font-bold">Total Estimado</span><span className="text-xl font-bold text-emerald-400">R$ {total.toFixed(2)}</span></div>
                        <div className="space-y-4">
                            {categories.map(category => {
                                const items = shopList.filter(i => i.category === category || (!i.category && category==="Outros"));
                                if(items.length === 0) return null;
                                return (
                                    <div key={category}>
                                        <h3 className="text-xs font-bold text-slate-500 uppercase mb-2 ml-1">{category}</h3>
                                        <div className="bg-slate-800 border border-slate-700 rounded-xl overflow-hidden">
                                            {items.map(item => (
                                                <div key={item.id} className="flex items-center gap-3 p-3 border-b border-slate-700 last:border-0 hover:bg-slate-750 transition-colors">
                                                    <button onClick={()=>toggle(item.id)} className={`w-5 h-5 rounded border flex items-center justify-center transition-all ${item.done?'bg-emerald-600 border-emerald-600':'border-slate-500'}`}>{item.done && <Icon name="check" size={14} className="text-white"/>}</button>
                                                    <div className="flex-1"><span className={`text-sm block ${item.done?'text-slate-600 line-through':'text-slate-200'}`}>{item.txt}</span><span className="text-[10px] text-slate-500 block">Qtd: {item.q} ‚Ä¢ R$ {item.p.toFixed(2)} un.</span></div>
                                                    <button onClick={()=>remove(item.id)} className="text-slate-600 hover:text-red-400"><Icon name="trash" size={16}/></button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        const Habits = ({ modal }) => {
            const [list, setList] = useStorage('habits_v24', []);
            return (
                <div className="h-full flex flex-col fade-in">
                    <div className="glass p-4 flex justify-between items-center z-10 border-b border-slate-800"><h2 className="text-xl font-bold text-blue-400 flex items-center gap-2"><Icon name="list" size={20}/> H√°bitos</h2><button onClick={()=>modal({open:true, title:"Novo", ok:t=>t&&setList([...list,{id:Date.now(),t}])})} className="bg-blue-600 text-white p-2 rounded-lg"><Icon name="plus" size={20}/></button></div>
                    <div className="content p-4 space-y-3">
                        {list.map(i => (<div key={i.id} className="bg-slate-800 border border-slate-700 p-4 rounded-xl flex justify-between items-center"><span className="text-slate-200">{i.t}</span><button onClick={()=>setList(list.filter(x=>x.id!==i.id))} className="text-slate-500 hover:text-emerald-400"><Icon name="check" size={24}/></button></div>))}
                        {!list.length && <p className="text-center text-slate-600 mt-10">Lista vazia.</p>}
                    </div>
                </div>
            );
        };

        const Agenda = ({ modal, evts, setEvts }) => {
             const [dt, setDt] = useState(new Date());
             const k = d => d.toISOString().split('T')[0];
             const selK = k(dt);
             const getDaysInMonth = (date) => new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
             const getFirstDayOfMonth = (date) => new Date(date.getFullYear(), date.getMonth(), 1).getDay();
             const daysInMonth = getDaysInMonth(dt);
             const firstDay = getFirstDayOfMonth(dt); 
             const holidays = { "01-01": "Confraterniza√ß√£o Universal", "04-21": "Tiradentes", "05-01": "Dia do Trabalho", "09-07": "Independ√™ncia", "10-12": "Nossa Sra. Aparecida", "11-02": "Finados", "11-15": "Proclama√ß√£o da Rep√∫blica", "12-25": "Natal" };
             const checkHoliday = (d, m) => { const key = `${(m+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`; return holidays[key]; };
             const getSortedEvents = (dateKey) => { const dailyEvents = evts[dateKey] || []; return [...dailyEvents].sort((a,b) => a.localeCompare(b)); };
             const sortedDayEvents = getSortedEvents(selK);

             return (
                <div className="flex flex-col h-full fade-in">
                    <div className="glass p-4 flex justify-between items-center border-b border-slate-800"><button onClick={()=>setDt(new Date(dt.getFullYear(),dt.getMonth()-1,1))}><Icon name="back" className="rotate-180"/></button><div className="text-center"><span className="font-bold text-purple-400 block uppercase text-lg">{dt.toLocaleString('pt-BR',{month:'long'})}</span><span className="text-xs text-slate-500 font-bold">{dt.getFullYear()}</span></div><button onClick={()=>setDt(new Date(dt.getFullYear(),dt.getMonth()+1,1))}><Icon name="back" className="scale-x-[-1]"/></button></div>
                    <div className="content p-4">
                        <div className="grid grid-cols-7 gap-1 text-center mb-2">{['D','S','T','Q','Q','S','S'].map((d,i)=> <span key={i} className={`text-xs font-bold ${i===0 || i===6 ? 'text-red-400/70':'text-slate-500'}`}>{d}</span>)}</div>
                        <div className="grid grid-cols-7 gap-1 text-center mb-6">
                            {Array.from({length: daysInMonth}).map((_,i)=>{
                                const d = i+1; const currentDayObj = new Date(dt.getFullYear(), dt.getMonth(), d); const isSel = d === dt.getDate(); const isToday = new Date().toDateString() === currentDayObj.toDateString(); const hol = checkHoliday(d, dt.getMonth()); const hasEvt = evts[k(currentDayObj)]?.length > 0;
                                return (<button key={d} onClick={()=>setDt(currentDayObj)} style={d===1 ? {gridColumnStart: firstDay + 1} : {}} className={`h-10 rounded-lg flex flex-col items-center justify-center relative border border-transparent ${isSel ? 'bg-purple-600 text-white shadow-lg' : 'bg-slate-800 text-slate-300 hover:bg-slate-700'} ${isToday && !isSel ? 'border-purple-500' : ''} ${hol ? 'text-red-300' : ''}`}><span className={`text-sm font-bold leading-none`}>{d}</span>{hasEvt && <span className="w-1 h-1 bg-blue-400 rounded-full mt-1"></span>}{hol && !isSel && <span className="text-[8px] opacity-50 absolute bottom-0.5">‚òÖ</span>}</button>)
                            })}
                        </div>
                        <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 min-h-[150px]">
                            <div className="flex justify-between mb-4 border-b border-slate-700 pb-2"><div><span className="font-bold block text-lg">Dia {dt.getDate()}</span>{checkHoliday(dt.getDate(), dt.getMonth()) && <span className="text-xs text-red-400 font-bold uppercase">{checkHoliday(dt.getDate(), dt.getMonth())}</span>}</div><button onClick={()=>modal({ open:true, title:"Novo Evento", isEvent: true, ok:t=>t&&setEvts({...evts,[selK]:[...(evts[selK]||[]),t]}) })} className="text-xs bg-purple-600 hover:bg-purple-500 text-white h-8 px-4 rounded-lg font-bold">Adicionar</button></div>
                            {sortedDayEvents.length === 0 ? (<p className="text-slate-600 text-sm italic">Nenhum evento.</p>) : (sortedDayEvents.map((e,i)=>(<div key={i} className="py-3 border-b border-slate-700/50 flex justify-between items-center last:border-0 group"><span className="text-slate-300 text-sm before:content-['‚Ä¢'] before:mr-2 before:text-purple-500">{e}</span><button onClick={()=>setEvts({...evts,[selK]:evts[selK].filter((x)=>x!==e)})} className="text-slate-600 hover:text-red-400 px-2"><Icon name="trash" size={14}/></button></div>)))}
                        </div>
                    </div>
                </div>
             );
        };

        const Kanban = ({ modal }) => {
            const [tasks, setTasks] = useStorage('kanban_v24', []);
            const cols = {todo:'A Fazer', doing:'Fazendo', done:'Feito'};
            return (
                <div className="flex flex-col h-full fade-in">
                    <div className="glass p-4 border-b border-slate-800"><h2 className="text-xl font-bold text-orange-400 flex gap-2"><Icon name="kanban"/> Projetos</h2></div>
                    <div className="flex-1 overflow-x-auto flex gap-4 p-4 pb-32 snap-x">
                        {Object.entries(cols).map(([k,v])=>(
                            <div key={k} className="min-w-[85vw] md:min-w-[300px] snap-center bg-slate-900 border border-slate-800 rounded-xl flex flex-col">
                                <div className="p-3 border-b border-slate-800 flex justify-between font-bold text-slate-500 uppercase text-xs"><span>{v}</span><button onClick={()=>modal({open:true, title:"Tarefa", ok:t=>t&&setTasks([...tasks,{id:Date.now(),t,s:k}])})}>+</button></div>
                                <div className="p-3 space-y-2 overflow-y-auto flex-1">
                                    {tasks.filter(t=>t.s===k).map(t=>(<div key={t.id} className="bg-slate-800 p-3 rounded border border-slate-700"><p className="text-sm mb-2">{t.t}</p><div className="flex justify-end gap-1">{Object.keys(cols).filter(x=>x!==k).map(x=><button key={x} onClick={()=>setTasks(tasks.map(z=>z.id===t.id?{...z,s:x}:z))} className="text-[9px] bg-slate-950 px-2 py-1 rounded uppercase">{cols[x]}</button>)}<button onClick={()=>setTasks(tasks.filter(z=>z.id!==t.id))} className="text-[9px] bg-red-900/20 text-red-400 px-2 py-1 rounded">X</button></div></div>))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const StudyTab = ({ modal, openCalc }) => {
            const [classes, setClasses] = useStorage('study_classes_v1', {});
            const [appointments, setAppointments] = useStorage('study_appointments_v1', []);
            const [notebooks, setNotebooks] = useStorage('study_multi_notebook_v1', [{id:1, t:'Geral', c:''}]);
            const [selNote, setSelNote] = useState(1);
            
            const [pomoTime, setPomoTime] = useState(25 * 60);
            const [pomoActive, setPomoActive] = useState(false);
            useEffect(() => { let i = null; if (pomoActive && pomoTime > 0) i = setInterval(() => setPomoTime(t => t - 1), 1000); return () => clearInterval(i); }, [pomoActive, pomoTime]);

            const activeNote = notebooks.find(n => n.id === selNote) || notebooks[0];
            const updateNote = (txt) => setNotebooks(notebooks.map(n => n.id === selNote ? {...n, c:txt} : n));
            const addPage = () => { const id = Date.now(); setNotebooks([...notebooks, {id, t:'Nova P√°g', c:''}]); setSelNote(id); };

            const days = ["Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado"];

            const addClass = (day) => {
                modal({ open: true, title: `Aula - ${day}`, ph: "Mat√©ria - Hor√°rio", ok: (val) => setClasses(prev => ({...prev, [day]: [...(prev[day]||[]), val]})) });
            };
            const removeClass = (day, idx) => {
                setClasses(prev => ({...prev, [day]: classes[day].filter((_, i) => i !== idx)}));
            };

            return (
                <div className="h-full flex flex-col fade-in">
                    <div className="glass p-4 sticky top-0 z-10 border-b border-slate-800 flex justify-between items-center">
                        <h2 className="text-xl font-bold text-cyan-400 flex items-center gap-2"><Icon name="book" size={20}/> √Årea de Estudo</h2>
                    </div>
                    
                    <div className="content p-4 space-y-6 pb-40"> 
                        <div className="space-y-3">
                            <h3 className="text-xs font-bold text-slate-400 uppercase flex items-center gap-2"><Icon name="calendar" size={14}/> Cronograma de Aulas</h3>
                            <div className="grid grid-cols-1 gap-3">
                                {days.map(day => (
                                    <div key={day} className="bg-slate-800/50 border border-slate-700/50 rounded-xl p-3">
                                        <div className="flex justify-between items-center mb-2 border-b border-slate-700/50 pb-1">
                                            <span className="text-sm font-bold text-cyan-200">{day}</span>
                                            <button onClick={()=>addClass(day)} className="text-cyan-500 bg-cyan-900/20 p-1 rounded hover:bg-cyan-900/40"><Icon name="plus" size={14}/></button>
                                        </div>
                                        <div className="space-y-1">
                                            {(classes[day] && classes[day].length > 0) ? classes[day].map((cls, idx) => (
                                                <div key={idx} className="flex justify-between items-start text-xs text-slate-300 bg-slate-900/50 p-2 rounded">
                                                    <span>{cls}</span>
                                                    <button onClick={()=>removeClass(day, idx)} className="text-red-400 opacity-50 hover:opacity-100"><Icon name="trash" size={12}/></button>
                                                </div>
                                            )) : <span className="text-[10px] text-slate-600 italic">Sem aulas cadastradas</span>}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="bg-slate-800 border border-slate-700 rounded-xl p-4">
                             <div className="flex justify-between items-center mb-3">
                                <h3 className="text-xs font-bold text-slate-400 uppercase">Atendimentos / Monitoria</h3>
                                <button onClick={()=>modal({ open:true, title:"Novo Atendimento", ph:"Prof. Silva - Sala 3", isEvent:true, ok: (val) => setAppointments([...appointments, {id:Date.now(), t:val}]) })} className="text-[10px] bg-slate-700 px-2 py-1 rounded text-white">Adicionar</button>
                             </div>
                             <div className="space-y-2">
                                {appointments.length === 0 && <p className="text-xs text-slate-600">Nenhum atendimento agendado.</p>}
                                {appointments.map(apt => (
                                    <div key={apt.id} className="flex justify-between items-center bg-slate-900 p-2 rounded border-l-2 border-purple-500">
                                        <span className="text-xs text-slate-200">{apt.t}</span>
                                        <button onClick={()=>setAppointments(appointments.filter(a=>a.id!==apt.id))} className="text-slate-600 hover:text-red-400"><Icon name="trash" size={14}/></button>
                                    </div>
                                ))}
                             </div>
                        </div>

                        <div className="space-y-3">
                             <h3 className="text-xs font-bold text-slate-400 uppercase">Caderno & Foco</h3>
                             <div className="bg-slate-800 border border-slate-700 rounded-xl overflow-hidden flex flex-col h-64 mb-4">
                                <div className="bg-slate-900 p-2 flex gap-2 overflow-x-auto no-scrollbar border-b border-slate-700">
                                    {notebooks.map(n => (<button key={n.id} onClick={()=>setSelNote(n.id)} className={`px-3 py-1 rounded text-[10px] font-bold whitespace-nowrap ${selNote===n.id ? 'bg-cyan-900/40 text-cyan-400' : 'bg-slate-800 text-slate-500'}`}>{n.t}</button>))}
                                    <button onClick={addPage} className="px-2 py-1 rounded bg-slate-700 text-slate-300 text-[10px]">+</button>
                                </div>
                                <div className="flex-1 relative">
                                    <input value={activeNote.t} onChange={e=>setNotebooks(notebooks.map(n=>n.id===selNote?{...n,t:e.target.value}:n))} className="w-full bg-transparent p-2 text-xs font-bold text-cyan-200 outline-none border-b border-slate-700/50 placeholder:text-slate-600" placeholder="T√≠tulo da P√°gina" />
                                    <textarea className="w-full h-[calc(100%-32px)] bg-slate-900/30 p-3 text-xs text-slate-300 outline-none resize-none leading-relaxed" value={activeNote.c} onChange={e=>updateNote(e.target.value)} placeholder="Anota√ß√µes de aula..."/>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-3">
                                <button onClick={openCalc} className="bg-slate-800 border border-slate-700 p-4 rounded-xl flex flex-col items-center justify-center gap-2 active:scale-95 transition-transform hover:bg-slate-750">
                                    <Icon name="calc" size={24} className="text-cyan-400"/>
                                    <span className="text-xs font-bold">Calc. Cient√≠fica</span>
                                </button>
                                <div className="bg-slate-800 border border-slate-700 p-4 rounded-xl flex flex-col items-center justify-center relative overflow-hidden">
                                     <span className="text-[10px] text-slate-500 uppercase font-bold mb-1">Pomodoro</span>
                                     <div className="text-xl font-mono font-bold text-white mb-1">{Math.floor(pomoTime/60)}:{(pomoTime%60).toString().padStart(2,'0')}</div>
                                     <button onClick={()=>setPomoActive(!pomoActive)} className={`text-[10px] px-3 py-1 rounded font-bold ${pomoActive?'bg-red-900/50 text-red-400':'bg-cyan-900/50 text-cyan-400'}`}>{pomoActive?'PAUSAR':'INICIAR'}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const DietTab = ({ modal }) => {
            const [view, setView] = useState('today'); 
            const [plans, setPlans] = useStorage('diet_plans_v1', []); 
            const [meals, setMeals] = useStorage('diet_log_v60', []); 
            
            const todayK = new Date().toLocaleDateString();
            const todayMeals = meals.filter(m => m.date === todayK);
            
            const totals = todayMeals.reduce((acc, m) => ({
                cal: acc.cal + (m.cal||0), p: acc.p + (m.p||0), c: acc.c + (m.c||0), f: acc.f + (m.f||0)
            }), {cal:0, p:0, c:0, f:0});

            const GOAL_CAL = 2000;
            const progress = Math.min(100, (totals.cal / GOAL_CAL) * 100);

            const addPlan = () => modal({ open: true, title: "Criar Modelo", isDietPlan: true, ph: "Nome (Ex: Caf√© da Manh√£ Padr√£o)", ok: (val) => setPlans([...plans, val]) });
            const logPlan = (p) => setMeals([{ ...p, date: todayK, id: Date.now() }, ...meals]);
            const logCustom = () => modal({ open: true, title: "Refei√ß√£o Avulsa", isDietPlan: true, ph: "Nome (Ex: Snack Extra)", ok: (val) => setMeals([{ ...val, date: todayK }, ...meals]) });

            return (
                <div className="h-full flex flex-col fade-in">
                    <div className="glass p-4 sticky top-0 z-10 border-b border-slate-800 flex justify-between items-center">
                        <div className="flex gap-4">
                            <button onClick={()=>setView('today')} className={`text-lg font-bold transition-colors ${view==='today'?'text-green-400':'text-slate-500'}`}>Hoje</button>
                            <button onClick={()=>setView('plan')} className={`text-lg font-bold transition-colors ${view==='plan'?'text-green-400':'text-slate-500'}`}>Modelos</button>
                        </div>
                        {view==='today' ? (
                            <button onClick={logCustom} className="bg-green-600 text-white px-3 py-1 rounded-lg text-xs font-bold shadow-lg flex items-center gap-1"><Icon name="plus" size={14}/> ADD</button>
                        ) : (
                            <button onClick={addPlan} className="bg-green-600 text-white px-3 py-1 rounded-lg text-xs font-bold shadow-lg flex items-center gap-1"><Icon name="plus" size={14}/> NOVO</button>
                        )}
                    </div>
                    
                    <div className="content p-4 space-y-5">
                        {view === 'today' ? (
                            <>
                                <div className="bg-slate-800 border border-slate-700 rounded-xl p-5 shadow-lg relative overflow-hidden">
                                    <div className="flex justify-between items-end mb-2 relative z-10">
                                        <div><span className="text-xs font-bold text-slate-400 uppercase">Calorias Hoje</span><div className="text-3xl font-bold text-white leading-none mt-1">{totals.cal} <span className="text-sm text-slate-500 font-normal">/ {GOAL_CAL}</span></div></div>
                                        <Icon name="fire" size={32} className={`${progress >= 100 ? 'text-red-500 animate-pulse' : 'text-slate-700'}`}/>
                                    </div>
                                    <div className="h-3 w-full bg-slate-900 rounded-full overflow-hidden relative z-10"><div className="h-full bg-gradient-to-r from-green-500 to-emerald-400 transition-all duration-500" style={{width: `${progress}%`}}></div></div>
                                    <div className="grid grid-cols-3 gap-2 mt-4 pt-4 border-t border-slate-700/50 relative z-10">
                                        <div className="text-center"><div className="text-[10px] text-blue-400 font-bold uppercase mb-1">Prot</div><div className="text-sm font-bold text-white bg-slate-900/50 rounded py-1">{totals.p}g</div></div>
                                        <div className="text-center"><div className="text-[10px] text-yellow-400 font-bold uppercase mb-1">Carb</div><div className="text-sm font-bold text-white bg-slate-900/50 rounded py-1">{totals.c}g</div></div>
                                        <div className="text-center"><div className="text-[10px] text-red-400 font-bold uppercase mb-1">Gord</div><div className="text-sm font-bold text-white bg-slate-900/50 rounded py-1">{totals.f}g</div></div>
                                    </div>
                                </div>
                                <div className="space-y-3">
                                    {todayMeals.length === 0 && <div className="text-center mt-10"><p className="text-slate-600 text-sm">Nada registrado hoje.</p><button onClick={()=>setView('plan')} className="text-green-400 text-xs font-bold mt-2 underline">Usar Modelo</button></div>}
                                    {todayMeals.map(m => (
                                        <div key={m.id} className="bg-slate-800 border border-slate-700 p-3 rounded-xl flex justify-between items-center group">
                                            <div className="flex items-center gap-3">
                                                <div className="bg-slate-900 w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold text-green-400 border border-slate-700">{m.cal}</div>
                                                <div><h4 className="font-bold text-slate-200 text-sm">{m.name}</h4><div className="text-[10px] text-slate-400 flex gap-2"><span>P: {m.p}g</span><span>C: {m.c}g</span><span>G: {m.f}g</span></div></div>
                                            </div>
                                            <button onClick={()=>setMeals(meals.filter(x=>x.id!==m.id))} className="text-slate-600 hover:text-red-500 p-2 opacity-50 group-hover:opacity-100 transition-opacity"><Icon name="trash" size={16}/></button>
                                        </div>
                                    ))}
                                </div>
                            </>
                        ) : (
                            <div className="space-y-3">
                                <p className="text-xs text-slate-500 mb-2 uppercase font-bold text-center">Toque no + para adicionar ao dia</p>
                                {plans.map(p => (
                                    <div key={p.id} className="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl flex justify-between items-center hover:bg-slate-750 transition-all text-left">
                                        <div><h4 className="font-bold text-slate-200 text-sm">{p.name}</h4><div className="text-[10px] text-slate-400 mt-1">{p.cal} kcal ‚Ä¢ P:{p.p} C:{p.c} F:{p.f}</div></div>
                                        <div className="flex gap-2">
                                            <button onClick={()=>setPlans(plans.filter(x=>x.id!==p.id))} className="text-slate-600 hover:text-red-400 p-2"><Icon name="trash" size={16}/></button>
                                            <button onClick={()=>logPlan(p)} className="bg-green-900/20 text-green-400 p-2 rounded-lg hover:bg-green-900/40"><Icon name="plus" size={16}/></button>
                                        </div>
                                    </div>
                                ))}
                                {plans.length === 0 && <p className="text-center text-slate-600 text-sm mt-10">Crie modelos de refei√ß√£o (ex: almo√ßo, janta) para agilizar seu dia a dia.</p>}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const WorkoutTab = ({ modal }) => {
            const [view, setView] = useState('plans'); 
            const [plans, setPlans] = useStorage('workout_plans_v2', []); 
            const [history, setHistory] = useStorage('workout_history_v3', []); 
            
            const [activePlan, setActivePlan] = useState(null);
            const [sessionTime, setSessionTime] = useState(0);
            const [sessionTimerActive, setSessionTimerActive] = useState(false);
            const [sessionData, setSessionData] = useState({});

            useEffect(() => {
                let interval = null;
                if (sessionTimerActive) {
                    interval = setInterval(() => setSessionTime(t => t + 1), 1000);
                }
                return () => clearInterval(interval);
            }, [sessionTimerActive]);

            const [expandedPlan, setExpandedPlan] = useState(null);
            const createPlan = () => modal({ open: true, title: "Criar Treino", isWorkoutPlan: true, ph: "Nome (Ex: Treino A - Costas)", ok: (val) => setPlans([...plans, val]) });
            const addExToPlan = (planId) => {
                modal({ open: true, title: "Adicionar Exerc√≠cio", isExercise: true, ph: "Nome do Exerc√≠cio", ok: (val) => {
                    setPlans(plans.map(p => p.id === planId ? { ...p, exercises: [...p.exercises, val] } : p));
                }});
            };
            const deletePlan = (e, id) => { e.stopPropagation(); if(confirm("Excluir este treino?")) setPlans(plans.filter(p => p.id !== id)); };
            const deleteEx = (planId, exId) => {
                setPlans(plans.map(p => p.id === planId ? { ...p, exercises: p.exercises.filter(x => x.id !== exId) } : p));
            };

            const startSession = (plan) => {
                setActivePlan(plan);
                setSessionTime(0);
                setSessionData({});
                setSessionTimerActive(true);
                setView('active');
            };

            const updateSessionInput = (exId, field, val) => {
                setSessionData(prev => ({
                    ...prev,
                    [exId]: { ...prev[exId], [field]: val }
                }));
            };

            const finishSession = () => {
                if(!confirm("Finalizar treino e salvar?")) return;
                setSessionTimerActive(false);
                
                const details = activePlan.exercises.map(ex => {
                    const d = sessionData[ex.id] || {};
                    const w = d.weight || "-";
                    const r = d.reps || "-";
                    return `${ex.name}: ${w}kg / ${r} reps`;
                });

                const entry = {
                    id: Date.now(),
                    date: new Date().toLocaleDateString(),
                    name: activePlan.name,
                    duration: `${Math.floor(sessionTime/60)}m ${sessionTime%60}s`,
                    exercises: details
                };

                setHistory([entry, ...history]);
                setActivePlan(null);
                setView('history');
            };

            const formatTime = (s) => {
                const m = Math.floor(s / 60).toString().padStart(2, '0');
                const sec = (s % 60).toString().padStart(2, '0');
                return `${m}:${sec}`;
            };

            if (view === 'active' && activePlan) {
                return (
                    <div className="h-full flex flex-col fade-in bg-slate-950">
                        <div className="p-4 bg-slate-900 border-b border-slate-800 flex justify-between items-center sticky top-0 z-20">
                            <div>
                                <h3 className="text-white font-bold text-lg">{activePlan.name}</h3>
                                <div className="text-red-400 font-mono text-xl font-bold flex items-center gap-2">
                                    <Icon name="clock" size={18}/> {formatTime(sessionTime)}
                                </div>
                            </div>
                            <button onClick={()=>setSessionTimerActive(!sessionTimerActive)} className={`p-3 rounded-full ${sessionTimerActive ? 'bg-yellow-600' : 'bg-green-600'}`}>
                                <Icon name={sessionTimerActive ? "lock" : "run"} size={20} className="text-white"/>
                            </button>
                        </div>
                        <div className="content p-4 space-y-4 pb-40">
                            {activePlan.exercises.map(ex => (
                                <div key={ex.id} className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                    <div className="flex justify-between mb-2">
                                        <span className="font-bold text-slate-200">{ex.name}</span>
                                        <span className="text-xs text-slate-500">Meta: {ex.sets}</span>
                                    </div>
                                    <div className="flex gap-3">
                                        <div className="flex-1">
                                            <label className="text-[9px] text-slate-400 uppercase font-bold">Peso (kg)</label>
                                            <input type="number" placeholder="-" className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white outline-none focus:border-red-500" 
                                                onChange={e=>updateSessionInput(ex.id, 'weight', e.target.value)} />
                                        </div>
                                        <div className="flex-1">
                                            <label className="text-[9px] text-slate-400 uppercase font-bold">Reps Feitas</label>
                                            <input type="number" placeholder="-" className="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white outline-none focus:border-red-500" 
                                                onChange={e=>updateSessionInput(ex.id, 'reps', e.target.value)} />
                                        </div>
                                    </div>
                                </div>
                            ))}
                            <button onClick={finishSession} className="w-full bg-red-600 hover:bg-red-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2">
                                <Icon name="save"/> FINALIZAR TREINO
                            </button>
                            <button onClick={()=>{if(confirm("Cancelar treino? Nada ser√° salvo.")) setView('plans');}} className="w-full text-slate-500 text-xs font-bold py-2">CANCELAR</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="h-full flex flex-col fade-in">
                    <div className="glass p-4 sticky top-0 z-10 border-b border-slate-800 flex justify-between items-center">
                        <div className="flex gap-4">
                            <button onClick={()=>setView('plans')} className={`text-lg font-bold transition-colors ${view==='plans'?'text-red-500':'text-slate-500'}`}>Meus Treinos</button>
                            <button onClick={()=>setView('history')} className={`text-lg font-bold transition-colors ${view==='history'?'text-red-500':'text-slate-500'}`}>Hist√≥rico</button>
                        </div>
                        {view === 'plans' && <button onClick={createPlan} className="bg-red-600 text-white px-3 py-1 rounded-lg text-xs font-bold shadow-lg flex items-center gap-1"><Icon name="plus" size={14}/> CRIAR</button>}
                    </div>
                    
                    <div className="content p-4 space-y-4 pb-40">
                        {view === 'plans' ? (
                            <>
                                {plans.length === 0 && <div className="text-center mt-20 opacity-50"><Icon name="dumbbell" size={48} className="mx-auto mb-2 text-slate-600"/><p className="text-slate-500 text-sm">Nenhum treino criado.</p></div>}
                                {plans.map(p => (
                                    <div key={p.id} className="bg-slate-800 border border-slate-700 rounded-xl overflow-hidden transition-all duration-300">
                                        <div onClick={()=>setExpandedPlan(expandedPlan === p.id ? null : p.id)} className="p-4 flex justify-between items-center cursor-pointer bg-slate-800 hover:bg-slate-750">
                                            <div className="flex items-center gap-3">
                                                <div className={`p-2 rounded-lg ${expandedPlan===p.id ? 'bg-red-600 text-white' : 'bg-slate-900 text-slate-500'}`}><Icon name="list" size={18}/></div>
                                                <div><h3 className="font-bold text-slate-200">{p.name}</h3><p className="text-[10px] text-slate-500">{p.exercises.length} exerc√≠cios</p></div>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <button onClick={(e)=>deletePlan(e, p.id)} className="text-slate-600 hover:text-red-500 p-2"><Icon name="trash" size={16}/></button>
                                                <Icon name="back" size={16} className={`text-slate-500 transition-transform ${expandedPlan===p.id ? '-rotate-90' : 'rotate-180'}`}/>
                                            </div>
                                        </div>
                                        
                                        {expandedPlan === p.id && (
                                            <div className="bg-slate-900/50 p-3 border-t border-slate-700 space-y-2">
                                                {p.exercises.map(ex => (
                                                    <div key={ex.id} className="flex justify-between items-center text-sm bg-slate-900 p-2 rounded border border-slate-700/50">
                                                        <span className="text-slate-300 flex-1">{ex.name}</span>
                                                        <span className="text-red-400 font-bold text-xs mr-3">{ex.sets}</span>
                                                        <button onClick={()=>deleteEx(p.id, ex.id)} className="text-slate-600 hover:text-red-400"><Icon name="trash" size={12}/></button>
                                                    </div>
                                                ))}
                                                <div className="flex gap-2 mt-3 pt-2 border-t border-slate-700/30">
                                                    <button onClick={()=>addExToPlan(p.id)} className="flex-1 py-2 rounded-lg bg-slate-800 text-slate-400 text-xs font-bold hover:text-white transition-colors">+ Exerc√≠cio</button>
                                                    <button onClick={()=>startSession(p)} className="flex-1 py-2 rounded-lg bg-red-600 text-white text-xs font-bold shadow-lg hover:bg-red-500 transition-colors flex items-center justify-center gap-1"><Icon name="run" size={14}/> INICIAR TREINO</button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </>
                        ) : (
                            <>
                                {history.length === 0 && <p className="text-center text-slate-600 text-sm mt-20">Hist√≥rico vazio.</p>}
                                {history.map(h => (
                                    <div key={h.id} className="bg-slate-800 border border-slate-700 p-4 rounded-xl shadow-md">
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <h3 className="font-bold text-slate-200 text-sm">{h.name}</h3>
                                                <span className="text-[9px] bg-slate-900 border border-slate-700 px-1.5 py-0.5 rounded text-slate-400">{h.date} ‚Ä¢ {h.duration}</span>
                                            </div>
                                            <button onClick={()=>setHistory(history.filter(x => x.id !== h.id))} className="text-slate-600 hover:text-red-500 p-1"><Icon name="trash" size={16}/></button>
                                        </div>
                                        <div className="space-y-1">
                                            {h.exercises.map((line, idx) => (
                                                <p key={idx} className="text-[10px] text-slate-400 border-l-2 border-red-900/30 pl-2">{line}</p>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </>
                        )}
                    </div>
                </div>
            );
        };

        const Utilities = ({ openCalc }) => {
            const [torchOn, setTorchOn] = useState(false);
            const toggleTorch = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                    const track = stream.getVideoTracks()[0];
                    if(!torchOn) { await track.applyConstraints({ advanced: [{ torch: true }] }); setTorchOn(true); window.torchTrack = track; }
                    else { if(window.torchTrack) { window.torchTrack.applyConstraints({ advanced: [{ torch: false }] }); window.torchTrack.stop(); } setTorchOn(false); }
                } catch(e) { alert("A lanterna n√£o est√° dispon√≠vel neste dispositivo/navegador."); setTorchOn(false); }
            };

            const [chkText, setChkText] = useState("");
            const [correctedText, setCorrectedText] = useState("");
            
            const checkSpelling = () => {
                if(!chkText) return;
                let res = chkText.replace(/\s+/g, ' ').trim();
                res = res.charAt(0).toUpperCase() + res.slice(1);
                const dictionary = { "nao": "n√£o", "naum": "n√£o", "n": "n√£o", "eh": "√©", "vc": "voc√™", "vcs": "voc√™s", "pq": "porque", "tbm": "tamb√©m", "tb": "tamb√©m", "hj": "hoje", "concerteza": "com certeza", "derrepente": "de repente", "menas": "menos", "seje": "seja", "mecher": "mexer", "nada haver": "nada a ver", "exess√£o": "exce√ß√£o", "excess√£o": "exce√ß√£o", "entao": "ent√£o", "sao": "s√£o", "irmao": "irm√£o", "coracao": "cora√ß√£o", "atencao": "aten√ß√£o", "situacao": "situa√ß√£o", "voce": "voc√™", "ate": "at√©", "sera": "ser√°", "ja": "j√°", "so": "s√≥", "ola": "ol√°", "facil": "f√°cil", "dificil": "dif√≠cil", "rapido": "r√°pido", "msg": "mensagem", "abs": "abra√ßos", "sdd": "saudade", "tlg": "t√° ligado", "vlw": "valeu", "p/": "para" };
                Object.keys(dictionary).forEach(key => { const reg = new RegExp(`\\b${key}\\b`, 'gi'); res = res.replace(reg, dictionary[key]); });
                res = res.replace(/(\w)\s+(mas|por√©m|contudo|todavia|entretanto|no entanto)\b/gi, '$1, $2');
                res = res.replace(/\s+([.,!?;:])/g, '$1'); 
                res = res.replace(/([.,!?;:])(?=[^\s])/g, '$1 '); 
                res = res.replace(/([.!?]\s+)([a-z])/g, (match, p1, p2) => p1 + p2.toUpperCase()); 
                if (!/[.!?;:]$/.test(res)) res += ".";
                setCorrectedText(res);
            };

            const [swTime, setSwTime] = useState(0);
            const [swActive, setSwActive] = useState(false);
            useEffect(() => { let interval = null; if (swActive) interval = setInterval(() => setSwTime(t => t + 10), 10); else clearInterval(interval); return () => clearInterval(interval); }, [swActive]);

            const [genPass, setGenPass] = useState("");
            const generatePass = () => { const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*"; let p = ""; for(let i=0; i<16; i++) p += chars.charAt(Math.floor(Math.random() * chars.length)); setGenPass(p); };

            return (
                <div className="h-full flex flex-col fade-in">
                    <div className="glass p-4 sticky top-0 z-10 border-b border-slate-800 flex justify-between items-center"><h2 className="text-xl font-bold text-white flex items-center gap-2"><Icon name="grid" size={20}/> Utilidades</h2></div>
                    <div className="content p-4 space-y-4">
                        <div className="bg-slate-800 border border-slate-700 p-3 rounded-xl flex flex-col items-center justify-center relative overflow-hidden">
                            <span className="text-[10px] text-slate-400 font-bold uppercase mb-1">Cron√¥metro</span>
                            <div className="text-4xl font-mono font-bold text-white mb-2 tracking-widest">{("0" + Math.floor((swTime / 60000) % 60)).slice(-2)}:{("0" + Math.floor((swTime / 1000) % 60)).slice(-2)}<span className="text-lg text-slate-500">.{("0" + ((swTime / 10) % 100)).slice(-2)}</span></div>
                            <div className="flex gap-2 w-full px-4"><button onClick={()=>setSwActive(!swActive)} className={`flex-1 py-2 rounded font-bold text-xs ${swActive?'bg-yellow-600 text-white':'bg-emerald-600 text-white'}`}>{swActive?'Pausar':'Iniciar'}</button><button onClick={()=>{setSwActive(false);setSwTime(0)}} className="px-4 py-2 rounded font-bold text-xs bg-slate-700 text-slate-300">Zerar</button></div>
                        </div>
                        <div className="grid grid-cols-2 gap-3">
                            <button onClick={openCalc} className="bg-slate-800 border border-slate-700 p-4 rounded-xl flex flex-col items-center justify-center gap-2 active:scale-95 transition-transform hover:bg-slate-750"><Icon name="calc" size={28} className="text-blue-400"/><span className="text-xs font-bold">Calculadora</span></button>
                            <div className="bg-slate-800 border border-slate-700 p-3 rounded-xl flex flex-col items-center justify-center text-center"><span className="text-[10px] text-slate-400 font-bold uppercase mb-1">Gerar Senha</span><div onClick={()=>{navigator.clipboard.writeText(genPass)}} className="text-xs font-mono bg-slate-900 p-1 rounded w-full mb-1 truncate select-all cursor-pointer text-blue-300 h-6">{genPass || "Clique Gerar"}</div><button onClick={generatePass} className="px-3 py-1 rounded text-[10px] font-bold bg-blue-600 text-white">Gerar Nova</button></div>
                        </div>
                        <button onClick={toggleTorch} className={`w-full p-4 rounded-xl border flex items-center justify-center gap-2 font-bold transition-all shadow-lg ${torchOn ? 'bg-yellow-500 border-yellow-400 text-black animate-pulse' : 'bg-slate-800 border-slate-700 text-slate-300'}`}><Icon name="flash" size={24}/>{torchOn ? "LANTERNA LIGADA" : "Ligar Lanterna"}</button>
                        <div className="bg-slate-800 border border-slate-700 p-4 rounded-xl">
                            <h4 className="text-[10px] text-slate-400 font-bold uppercase mb-3 flex items-center gap-1"><Icon name="checktext" size={14} className="text-emerald-400"/> Corretor + Pontua√ß√£o V2</h4>
                            <textarea value={chkText} onChange={e=>setChkText(e.target.value)} placeholder="Cole seu texto aqui..." className="w-full bg-slate-900 p-3 rounded text-sm mb-2 text-white outline-none h-24 resize-none border border-slate-700 focus:border-emerald-500 transition-colors"/>
                            <button onClick={checkSpelling} className="w-full bg-emerald-700 hover:bg-emerald-600 text-white py-2 rounded text-xs font-bold mb-3 shadow-lg">Corrigir e Formatar</button>
                            {correctedText && (<div className="bg-slate-900/80 p-3 rounded border border-emerald-900/50"><p className="text-[10px] text-slate-500 uppercase mb-1 font-bold">Resultado:</p><p className="text-sm text-emerald-100 font-medium break-words select-all" onClick={()=>{navigator.clipboard.writeText(correctedText)}}>{correctedText}</p></div>)}
                        </div>
                    </div>
                </div>
            );
        };

        const Dashboard = ({ openCalc, events, setTab, requestNotify, notifyPerm }) => {
            const [weather, setWeather] = useState(null);
            const [loadingWeather, setLoadingWeather] = useState(false);
            const [finances, setFinances] = useState(null);
            const getTodayCount = () => { const k = new Date().toISOString().split('T')[0]; return events[k] ? events[k].length : 0; };
            const todayCount = getTodayCount();
            const tips = useMemo(() => ["Descanse seus olhos.", "Beba √°gua!", "Documente seu c√≥digo.", "Use 'const' sempre que puder.", "Fa√ßa commits frequentes.", "Revise antes de enviar.", "Aprenda atalhos.", "Limpe sua mesa."], []);
            const tip = useMemo(() => tips[Math.floor(Math.random() * tips.length)], []);

            const getClima = async (forceLoc = false) => {
               setLoadingWeather(true);
               // CAMPO LARGO COORDS
               const fallbackLat = -25.4597; 
               const fallbackLon = -49.5286;
               
               const fetchW = async (la, lo, lb) => {
                   try {
                       const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${la}&longitude=${lo}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m,apparent_temperature&daily=temperature_2m_max,temperature_2m_min&timezone=auto`);
                       const data = await res.json();
                       let label = lb;
                       if (!label && la && lo) {
                           try {
                               const geo = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${la}&lon=${lo}`);
                               const geoData = await geo.json();
                               label = geoData.address.city || geoData.address.town || "Local Atual";
                           } catch { label = "Campo Largo (GPS)"; }
                       }
                       setWeather({ temp: data.current.temperature_2m, code: data.current.weather_code, humid: data.current.relative_humidity_2m, wind: data.current.wind_speed_10m, feels: data.current.apparent_temperature, min: data.daily.temperature_2m_min[0], max: data.daily.temperature_2m_max[0], label: label });
                   } catch { setWeather({temp: "--", label: "Erro na API"}); } finally { setLoadingWeather(false); }
               };
               if (forceLoc && "geolocation" in navigator) {
                   navigator.geolocation.getCurrentPosition(
                       (pos) => fetchW(pos.coords.latitude, pos.coords.longitude),
                       (err) => { fetchW(fallbackLat, fallbackLon, "Campo Largo (Padr√£o)"); },
                       { timeout: 10000, enableHighAccuracy: true }
                   );
               } else { fetchW(fallbackLat, fallbackLon, "Campo Largo (Padr√£o)"); }
            };

            useEffect(() => { 
                getClima(true);
                fetch('https://economia.awesomeapi.com.br/last/USD-BRL,EUR-BRL,BTC-BRL').then(res => res.json()).then(data => setFinances(data)).catch(err => console.error(err));
            }, []);

            const getWeatherStatus = (code) => {
                if(code === 0) return { t: "C√©u Limpo", i: "sun", c: "text-yellow-400" };
                if(code >= 1 && code <= 3) return { t: "Nublado", i: "cloud", c: "text-slate-300" };
                if(code >= 51 && code <= 67) return { t: "Chuva", i: "rain", c: "text-blue-400" };
                if(code >= 71) return { t: "Neve", i: "cloud", c: "text-white" };
                if(code >= 95) return { t: "Tempestade", i: "rain", c: "text-purple-400" };
                return { t: "...", i: "sun", c: "text-slate-400" };
            };
            const wStatus = weather && weather.code !== undefined ? getWeatherStatus(weather.code) : {t:"...", i:"sun"};

            return (
                <div className="h-full flex flex-col fade-in">
                    <div className="glass p-5 sticky top-0 z-10 border-b border-slate-800 flex justify-between items-center">
                        <div><h1 className="text-xl font-bold text-white bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-400">Dev.Pro Suite</h1><p className="text-xs text-slate-500">{new Date().toLocaleDateString('pt-BR', {weekday: 'long', day:'numeric'})}</p></div>
                        <div className="relative"><button onClick={requestNotify} className="p-2 relative active:scale-95 transition-transform"><Icon name="bell" className={notifyPerm === 'granted' ? "text-emerald-400" : (notifyPerm === 'denied' ? "text-red-400" : "text-slate-400")} />{todayCount > 0 && <span className="absolute top-0 right-0 bg-red-500 text-white text-[8px] font-bold w-4 h-4 flex items-center justify-center rounded-full animate-bounce">{todayCount}</span>}</button></div>
                    </div>
                    <div className="content p-4 space-y-4">
                        <SystemStatus />
                        <MiniWeek events={events} onGoToAgenda={() => setTab('agenda')} />
                        {todayCount > 0 && (<div className="bg-purple-900/30 border border-purple-500/50 p-3 rounded-xl flex items-center gap-3 animate-pulse"><Icon name="calendar" className="text-purple-400"/><div><h4 className="text-xs font-bold text-purple-200">Agenda Hoje</h4><p className="text-sm text-white">Voc√™ tem <b>{todayCount}</b> compromissos hoje.</p></div></div>)}
                        <div className="grid grid-cols-3 gap-2"><FinanceCard label="D√≥lar" value={finances?.USDBRL?.bid} trend={finances?.USDBRL?.pctChange} /><FinanceCard label="Euro" value={finances?.EURBRL?.bid} trend={finances?.EURBRL?.pctChange} /><FinanceCard label="Bitcoin" value={finances?.BTCBRL?.bid} isBtc /></div>
                        <div className="bg-gradient-to-br from-indigo-900 to-slate-900 border border-indigo-500/30 rounded-2xl p-5 text-white shadow-xl relative overflow-hidden">
                            <div className="absolute -right-4 -top-4 opacity-10"><Icon name={wStatus.i} size={100} className={wStatus.c}/></div>
                            <div className="relative z-10 flex justify-between items-end">
                                <div>
                                    <h3 className="font-bold text-sm text-indigo-300 flex items-center gap-2 uppercase tracking-wider mb-1"><Icon name={wStatus.i} size={14} className={wStatus.c}/> {wStatus.t}</h3>
                                    <div className="flex items-end gap-2"><span className="text-4xl font-bold">{weather ? Math.round(weather.temp) + "¬∞" : "--"}</span><span className="text-sm opacity-70 mb-1">{weather ? weather.label : "..."}</span></div>
                                    {weather && (<div className="flex gap-3 mt-2 text-xs opacity-70"><span>Sensa√ß√£o: <b>{Math.round(weather.feels)}¬∞</b> | M√≠n: {Math.round(weather.min)}¬∞ M√°x: {Math.round(weather.max)}¬∞</span><span>üíß {weather.humid}% | üí® {weather.wind} km/h</span></div>)}
                                </div>
                                <button onClick={() => getClima(true)} className={`text-indigo-300 bg-indigo-950/50 p-2 rounded-lg hover:bg-indigo-900 ${loadingWeather ? 'animate-spin' : ''}`}><Icon name="refresh" size={20}/></button>
                            </div>
                        </div>
                        <div className="bg-slate-800 border border-slate-700 p-4 rounded-xl flex items-start gap-3"><div className="bg-yellow-900/20 p-2 rounded-full text-yellow-400"><Icon name="bulb" size={20}/></div><div><h4 className="text-xs font-bold text-yellow-400 uppercase mb-1">Dica do Dia</h4><p className="text-sm text-slate-300 italic">"{tip}"</p></div></div>
                        <div className="space-y-2"><h3 className="text-xs font-bold text-slate-500 uppercase ml-1">Links R√°pidos</h3><QuickLinks /></div>
                        <div className="grid grid-cols-1 gap-3"><Scratchpad /></div>
                    </div>
                </div>
            );
        };

        const NewsFeed = () => {
            const [news, setNews] = useState([]);
            const [loading, setLoading] = useState(false);
            const [lastUpdate, setLastUpdate] = useStorage('news_last_update', 0);
            const [cachedNews, setCachedNews] = useStorage('news_cache_data', []);
            const extractImage = (item) => {
                if (item.thumbnail) return item.thumbnail;
                if (item.enclosure && item.enclosure.link && item.enclosure.type && item.enclosure.type.startsWith('image')) return item.enclosure.link;
                const imgRegex = /<img.*?src=["'](.*?)["']/; const match = imgRegex.exec(item.content || item.description); return (match && match[1]) ? match[1] : null;
            };
            const fetchFeed = async () => {
                setLoading(true);
                try {
                    const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=https://www.cnnbrasil.com.br/feed/&t=${Date.now()}`);
                    const data = await res.json();
                    if(data.status === 'ok') { setNews(data.items); setCachedNews(data.items); setLastUpdate(Date.now()); }
                } catch(e) { console.error(e); }
                setLoading(false);
            };
            useEffect(() => {
                const now = new Date(); const last = new Date(lastUpdate); const isDifferentDay = now.getDate() !== last.getDate() || now.getMonth() !== last.getMonth();
                if (isDifferentDay || cachedNews.length === 0) fetchFeed(); else setNews(cachedNews);
            }, []);
            return (
                <div className="h-full flex flex-col fade-in">
                    <div className="glass p-4 sticky top-0 z-10 flex justify-between items-center border-b border-slate-800"><h2 className="text-xl font-bold text-emerald-400 flex items-center gap-2"><Icon name="news" size={20}/> CNN Feed</h2><button onClick={fetchFeed} className={`text-slate-400 p-2 rounded-full hover:bg-slate-800 flex gap-2 items-center text-xs font-bold ${loading ? 'animate-pulse text-emerald-400' : ''}`}><Icon name="refresh" size={16}/> {loading ? "..." : "ATUALIZAR"}</button></div>
                    <div className="content p-4 space-y-4">
                        {loading && <div className="text-center text-emerald-400 text-sm mt-10 animate-pulse">Buscando as √∫ltimas manchetes...</div>}
                        {!loading && news.length === 0 && <div className="text-center mt-20 text-slate-500">Sem not√≠cias. Tente atualizar.</div>}
                        {news.map((item, idx) => {
                            const imgUrl = extractImage(item);
                            return (
                                <div key={idx} className="bg-slate-800 border border-slate-700 rounded-xl shadow-sm flex flex-col overflow-hidden">
                                    {imgUrl ? <img src={imgUrl} alt="News" className="w-full h-36 object-cover" onError={(e) => e.target.style.display='none'}/> : <div className="w-full h-24 bg-slate-900 flex items-center justify-center text-slate-700"><Icon name="news" size={40}/></div>}
                                    <div className="p-4 flex flex-col gap-2"><h3 className="font-bold text-slate-100 text-sm leading-snug line-clamp-2">{item.title}</h3><div className="flex justify-between items-center border-t border-slate-700/50 pt-2 mt-1"><span className="text-[10px] text-slate-500 uppercase">{new Date(item.pubDate).toLocaleDateString()}</span><a href={item.link} target="_blank" className="text-emerald-400 text-xs font-bold flex items-center gap-1 hover:underline bg-emerald-900/20 px-2 py-1 rounded">Ler Not√≠cia <Icon name="external" size={10}/></a></div></div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const Notes = ({ modal }) => {
            const [pass, setPass] = useStorage('vault_pass', null);
            const [lock, setLock] = useState(true);
            const [inp, setInp] = useState("");
            const [notes, setNotes] = useStorage('notes_v24', []);
            const [act, setAct] = useState(null);
            const active = notes.find(n=>n.id===act);
            const print = () => { if(!active) return; document.getElementById('print-area').innerHTML = `<div style="padding: 40px; font-family: sans-serif;"><h1 style="border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px;">${active.t}</h1><pre style="white-space: pre-wrap; font-family: sans-serif; line-height: 1.6;">${active.c}</pre><div style="margin-top: 50px; font-size: 12px; color: #666; border-top: 1px solid #ccc; padding-top: 10px;">Dev.Pro Suite ‚Ä¢ ${active.d}</div></div>`; setTimeout(()=>window.print(), 100); };
            const share = () => { if(!active) return; const txt = `*${active.t}*\n\n${active.c}`; window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(txt)}`, '_blank'); };
            const deleteNote = () => { if(confirm("Tem certeza que deseja apagar esta nota?")) { setNotes(notes.filter(n => n.id !== act)); setAct(null); } };

            if(!pass) return ( <div className="h-full flex items-center justify-center p-6 fade-in"><div className="bg-slate-800 p-8 rounded-2xl border border-slate-700 w-full max-w-sm text-center shadow-2xl"><Icon name="lock" size={48} className="mx-auto text-blue-400 mb-4"/><h2 className="text-white font-bold text-xl mb-2">Definir Senha</h2><p className="text-slate-400 text-sm mb-6">Proteja suas notas privadas.</p><input className="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-center text-white mb-4 outline-none text-lg" type="password" value={inp} onChange={e=>setInp(e.target.value)} placeholder="Nova Senha" autoFocus /><button onClick={()=>{ if(inp.length>3) setPass(inp); else alert("M√≠nimo 4 caracteres"); }} className="bg-blue-600 hover:bg-blue-500 w-full py-3 rounded-lg font-bold text-white shadow-lg transition-colors">CRIAR COFRE</button></div></div> );
            if(lock) return ( <div className="h-full flex items-center justify-center p-6 fade-in"><div className="bg-slate-800 p-8 rounded-2xl border border-slate-700 w-full max-w-sm text-center shadow-2xl"><div className="flex justify-center mb-6 text-slate-500 bg-slate-900 w-20 h-20 rounded-full items-center mx-auto border border-slate-700"><Icon name="lock" size={32}/></div><h2 className="text-white font-bold text-xl mb-6">Cofre Bloqueado</h2><form onSubmit={e=>{e.preventDefault(); if(inp===pass){setLock(false);setInp("")}else alert("Senha incorreta");}}><input className="w-full bg-slate-900 border border-slate-600 rounded-lg p-4 text-center text-white mb-6 outline-none text-xl tracking-widest" type="password" value={inp} onChange={e=>setInp(e.target.value)} placeholder="Senha" autoFocus /><button className="bg-blue-600 hover:bg-blue-500 w-full py-3 rounded-lg font-bold text-white shadow-lg transition-colors">DESBLOQUEAR</button></form></div></div> );
            if(active) return ( <div className="absolute inset-0 bg-slate-950 z-50 flex flex-col fade-in"><div className="glass p-3 flex items-center gap-2 border-b border-slate-800"><button onClick={()=>setAct(null)} className="bg-slate-800 hover:bg-slate-700 text-slate-300 p-2 sm:px-3 sm:py-2 rounded-lg text-xs font-bold flex items-center gap-1 transition-colors shrink-0"><Icon name="back" size={16}/> <span className="hidden sm:inline">VOLTAR</span></button><input className="flex-1 bg-transparent font-bold text-white outline-none px-2 text-lg min-w-0" value={active.t} onChange={e=>setNotes(notes.map(n=>n.id===act?{...n,t:e.target.value}:n))} placeholder="T√≠tulo..."/><button onClick={deleteNote} className="bg-red-900/30 text-red-400 p-2 rounded-lg shrink-0"><Icon name="trash" size={18}/></button></div><div className="bg-slate-900 border-b border-slate-800 p-2 flex gap-3 overflow-x-auto no-scrollbar"><button onClick={share} className="flex items-center gap-1 bg-green-900/20 text-green-400 hover:bg-green-900/30 px-3 py-1.5 rounded-lg text-xs font-bold transition-colors whitespace-nowrap"><Icon name="whatsapp" size={16}/> WhatsApp</button><button onClick={print} className="flex items-center gap-1 bg-slate-800 text-slate-300 hover:bg-slate-700 px-3 py-1.5 rounded-lg text-xs font-bold transition-colors whitespace-nowrap"><Icon name="pdf" size={16}/> Exportar PDF</button></div><textarea className="flex-1 bg-slate-950 p-5 text-slate-300 outline-none resize-none text-lg leading-relaxed placeholder:text-slate-700 w-full h-full overflow-y-auto pb-20" value={active.c} onChange={e=>setNotes(notes.map(n=>n.id===act?{...n,c:e.target.value}:n))} placeholder="Digite sua nota aqui..."/></div> );

            return (
                <div className="h-full flex flex-col fade-in">
                    <div className="glass p-4 sticky top-0 z-10 space-y-3 border-b border-slate-800"><div className="flex justify-between items-center"><span className="font-bold text-xl text-white flex items-center gap-2"><Icon name="lock" size={20}/> Cofre</span><button onClick={()=>{const id=Date.now(); setNotes([{id,t:'',c:'',d:new Date().toLocaleDateString()},...notes]); setAct(id);}} className="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg text-xs font-bold flex gap-1 items-center uppercase shadow-lg transition-colors"><Icon name="plus" size={16}/> Nova</button></div></div>
                    <div className="content p-4 grid grid-cols-2 gap-3">
                        {notes.map(n=>(<div key={n.id} onClick={()=>setAct(n.id)} className="bg-slate-800 p-4 rounded-xl border border-slate-700 h-40 overflow-hidden hover:border-blue-500/50 transition-colors cursor-pointer flex flex-col shadow-sm group"><h4 className="font-bold mb-2 text-slate-200 text-sm line-clamp-2">{n.t || "Sem T√≠tulo"}</h4><p className="text-xs text-slate-500 line-clamp-3 flex-1">{n.c || "Conte√∫do vazio..."}</p><span className="text-[10px] text-slate-600 mt-2 block text-right group-hover:text-slate-400">{n.d}</span></div>))}
                        {notes.length === 0 && <p className="col-span-2 text-center text-slate-600 mt-10">Cofre vazio.</p>}
                    </div>
                    <div className="fixed bottom-28 right-4 z-30"><button onClick={()=>setLock(true)} className="bg-slate-800 border border-slate-600 text-slate-300 p-3 rounded-full shadow-xl flex items-center gap-2 font-bold text-xs pr-4 hover:bg-slate-700 transition-colors"><span className="bg-slate-700 p-1 rounded-full"><Icon name="lock" size={14}/></span> BLOQUEAR</button></div>
                </div>
            );
        };

        // --- ROOT ---
        const App = () => {
            const [tab, setTab] = useState('home');
            const [mod, setMod] = useState({open:false});
            const [agendaEvts, setAgendaEvts] = useStorage('agenda_v24', {});
            const [notifyPerm, requestNotify] = useNotifications(agendaEvts);

            return (
                <div className="h-full w-full flex flex-col font-sans text-slate-100 bg-slate-950">
                    <Modal cfg={mod} close={()=>setMod({...mod, open:false})} />
                    
                    <main className="flex-1 overflow-hidden relative w-full h-full">
                        {tab==='home' && <Dashboard openCalc={()=>setMod({open:true, isCalc:true})} events={agendaEvts} setTab={setTab} requestNotify={requestNotify} notifyPerm={notifyPerm} />}
                        {tab==='news' && <NewsFeed />}
                        {tab==='utils' && <Utilities openCalc={()=>setMod({open:true, isCalc:true})} />}
                        {tab==='shop' && <ShoppingList />}
                        {tab==='habits' && <Habits modal={setMod} />}
                        {tab==='agenda' && <Agenda evts={agendaEvts} setEvts={setAgendaEvts} modal={setMod} />}
                        {tab==='kanban' && <Kanban modal={setMod} />}
                        {tab==='notes' && <Notes modal={setMod} />}
                        
                        {/* NOVAS ABAS */}
                        {tab==='study' && <StudyTab modal={setMod} openCalc={()=>setMod({open:true, isCalc:true})} />}
                        {tab==='workout' && <WorkoutTab modal={setMod} />}
                        {tab==='diet' && <DietTab modal={setMod} />}
                    </main>

                    <nav className="fixed bottom-0 w-full bg-slate-900/95 border-t border-slate-800 pb-8 pt-3 px-2 z-40 h-[90px] backdrop-blur-md overflow-x-auto no-scrollbar flex items-center gap-2">
                        {[
                            {id:'home', l:'In√≠cio', i:'home'},
                            {id:'study', l:'Estudo', i:'book'},
                            {id:'workout', l:'Treino', i:'dumbbell'},
                            {id:'diet', l:'Dieta', i:'apple'}, 
                            {id:'news', l:'Feed', i:'news'},
                            {id:'shop', l:'Compras', i:'cart'},
                            {id:'utils', l:'Util', i:'grid'},
                            {id:'notes', l:'Cofre', i:'lock'},
                            {id:'kanban', l:'Projetos', i:'kanban'},
                            {id:'agenda', l:'Agenda', i:'calendar'},
                            {id:'habits', l:'H√°bitos', i:'list'}
                        ].map(b => (
                            <button key={b.id} onClick={()=>setTab(b.id)} className={`flex flex-col items-center justify-center gap-1 min-w-[64px] h-full transition-all active:scale-95 ${tab===b.id?'text-blue-400':'text-slate-500 hover:text-slate-300'}`}>
                                <Icon name={b.i} size={22} className={tab===b.id ? "drop-shadow-[0_0_8px_rgba(96,165,250,0.5)]" : ""} />
                                <span className="text-[9px] font-bold uppercase tracking-wide">{b.l}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
